# Repository Organization Rule

**Prime directive:** Maintain a predictable, documented structure. Do not create new top-level folders, configs, or conventions without updating the docs and index described below.

---

## 0) Before you start

* **Generate a repo index:** create/update `docs/repo_map.md` (high-level map of directories + purpose) and `docs/decisions/` (Architecture Decision Records, ADRs).
* **Adopt the standard layout** (create missing items):

```
/README.md              # product overview, quickstart, decisions link
/CONTRIBUTING.md        # how to dev, test, release
/CHANGELOG.md           # human-readable changes (or rely on releases)
/LICENSE
/.editorconfig
/.gitattributes
/.gitignore
/.github/               # workflows, PR templates, issue templates
/src/                   # application/library source
/tests/                 # mirrors /src structure; unit/integration
/scripts/               # one-off CLI scripts and dev tooling
/config/                # runtime config (non-secret), default YAML/JSON
/docs/                  # user & dev docs
/docs/decisions/        # ADRs: 0001-… (why, not just what)
/examples/              # small runnable examples
/tools/                 # build/dev tools (formatters, codegen)
/generated/             # code generated by tools (never hand-edit)
/data/                  # (optional) small sample data; NO large files
```

**Guardrail:** Adding a new **top-level** directory requires (1) ADR entry, (2) `docs/repo_map.md` update, and (3) a note in `README.md` “Structure” section.

---

## 1) Naming & structure conventions

* **Files & dirs:** `snake_case` for Python, `kebab-case` for JS/TS frontends, `PascalCase` for components/classes. Be consistent per language.
* **One module = one responsibility.** Don’t dump unrelated functions into catch-all files.
* **Entry points:** put CLIs in `/src/<pkg>/cli/` or `/scripts/` with a shebang and brief usage.
* **Generated code:** must live **only** under `/generated/` and be clearly marked at top: `// GENERATED FILE – DO NOT EDIT`.

---

## 2) Documentation minimums (keep them short but current)

* **README.md** must include: Purpose, Quickstart, Structure (tree), How to Run/Develop/Test, Configuration, Release/Deploy, Links to ADRs.
* **ADRs:** create/update an ADR for any structural, dependency, or architectural change. Filename: `NNNN-title.md` with Context, Decision, Consequences.
* **Code comments:** document public APIs and non-obvious logic. Avoid narrative comments that drift; prefer ADRs for rationale.

---

## 3) Configuration & secrets

* Keep **non-secret defaults** in `/config/` (YAML or JSON). Load overrides from env vars.
* Provide `.env.example` with keys and safe placeholders. **Never** commit real secrets.
* Add secret files/patterns to `.gitignore`. Rotate/redact immediately if leaked.

---

## 4) Dependencies

* Pin versions and check in a lockfile (`package-lock.json`, `poetry.lock`, `Pipfile.lock`, etc.).
* Remove unused deps within the same PR that deletes their last usage.
* External tools required to build/run must be listed in `CONTRIBUTING.md` with versions.

---

## 5) Testing & quality gates

* Mirror `/src` structure under `/tests`. Every exported public function/class gets tests.
* Enforce gates in CI:

  * Lint
  * Format
  * Type check (e.g., mypy/tsc)
  * Tests with coverage threshold (e.g., **80%** lines, no files <60% without ADR waiver)
* Block merges on gate failures. No “temporary” skips without an ADR note.

---

## 6) Git & change hygiene

* **Branching:** `feat/*`, `fix/*`, `chore/*`, `docs/*`, `refactor/*`.
* **Commits:** Conventional Commits (e.g., `feat: add auth middleware`).
* **PRs:** ≤ 400 lines diff preferred; larger changes must include an ADR and PR checklist (see below).
* **Changelog:** update `CHANGELOG.md` or release notes on version bumps.

---

## 7) Data, assets, and large files

* No binaries or assets >5MB in repo (use object storage or LFS if policy allows).
* Place small sample data only in `/data/` with a README explaining provenance and license.

---

## 8) Project wiring & CI

* Provide `makefile` or `scripts/` for:

  * `setup` (install deps, pre-commit hooks)
  * `lint`, `format`, `typecheck`, `test`, `build`, `start`
* CI runs the same commands. CI config lives under `/.github/workflows/`.

---

## 9) Refactors & deletions

* Refactors that move files must update imports, tests, docs, CI, and `docs/repo_map.md` in the **same PR**.
* Delete dead code + tests together. Remove stale docs and update the structure tree.

---

## 10) AI/agent-specific guardrails

* Do not create files/folders outside the structure above without ADR + repo\_map update.
* Before adding a dependency, check if an existing one solves the need; if adding, justify in PR description.
* Keep generated content out of `/src` (must live in `/generated/`).
* When uncertain between multiple approaches, propose options in an ADR stub and pick one; do not mix patterns.
* On each change, **synchronize**: update `README` “Structure”, `docs/repo_map.md`, and ADRs as applicable.

---

## 11) Pre-commit & formatting (mandatory)

Install and enforce pre-commit hooks. Example `.pre-commit-config.yaml` (adapt per stack):

```yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: check-yaml
      - id: end-of-file-fixer
      - id: trailing-whitespace
  - repo: https://github.com/psf/black
    rev: 24.4.2
    hooks:
      - id: black
  - repo: https://github.com/charliermarsh/ruff-pre-commit
    rev: v0.5.0
    hooks:
      - id: ruff
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.10.0
    hooks:
      - id: mypy
```

Add language-equivalent formatters/linters for JS/TS, Go, etc. Ensure CI runs the same tools.

---

## 12) Required ignores & editor settings

* `.gitignore` must cover: `venv/`, `.venv/`, `node_modules/`, `dist/`, `build/`, `.pytest_cache/`, `.mypy_cache/`, `.DS_Store`, `.env`, `*.log`, `/generated/**` (if re-producible).
* `.editorconfig` (tabs/spaces, line endings, indent size) to normalize editors.

---

## 13) PR checklist (template)

Include this in PRs (copy into description):

* [ ] Directory structure unchanged or ADR added & `repo_map.md` updated
* [ ] README “Structure” section updated
* [ ] New deps justified; lockfile updated
* [ ] Lint/format/typecheck/test passing; coverage ≥ threshold
* [ ] Secrets absent; `.env.example` updated if needed
* [ ] Docs/examples/tests updated with code changes
* [ ] No binaries/large files; data policy respected

---

## 14) Minimal starter files (create if missing)

* `README.md` with **Purpose**, **Quickstart**, **Structure**, **Develop**, **Test**, **Config**, **Release**, **ADRs link**
* `docs/repo_map.md` with a 10–30 line tree and one-line purpose per dir
* `docs/decisions/0001-initial-structure.md` (first ADR)
* `CONTRIBUTING.md` with toolchain, commands, CI overview, code style
* `.editorconfig`, `.gitattributes`, `.gitignore`, `.pre-commit-config.yaml`
* CI workflow: `.github/workflows/ci.yml` running format/lint/typecheck/tests

---

### Agent success criteria (self-check on every commit)

1. Can a new dev run `setup`, `start`, and `test` within 10 minutes using the README?
2. Does `repo_map.md` accurately reflect the tree?
3. Are there zero unexplained top-level files/folders?
4. Do CI gates pass without local tweaks?
5. Does each change have a clear home under `/src`, `/tests`, `/docs`, `/config`, `/scripts`, or `/generated/`?

---
